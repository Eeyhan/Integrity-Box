<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flag Control</title>
<style>
@font-face{font-family:Mona;src:url('mona.ttf') format('truetype');font-display:swap}
:root{--bg:#fff0f4;--fg:#111;--card:#fff;--muted:#6b7280;--shadow:rgba(0,0,0,.12);--track:#fff0f4;--on:#34c759;--danger:#FF0E00}
body.dark{--bg:#1c1c1e;--fg:#f5f5f7;--card:#2c2c2e;--muted:#a1a1aa;--shadow:rgba(0,0,0,.55);--track:#3a3a3c}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font-family:Mona,-apple-system,BlinkMacSystemFont,"San Francisco",Arial,sans-serif;display:grid;place-items:center;min-height:100vh;transition:background .25s,color .25s}
.card{width:300px;background:var(--card);border-radius:20px;box-shadow:0 12px 28px var(--shadow);padding:22px}
.h{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.h .title{font-size:18px;font-weight:700}
.row{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(0,0,0,.06)}
body.dark .row{border-bottom:1px solid rgba(255,255,255,.06)}
.left{display:flex;align-items:center;gap:10px}
.icon{width:22px;height:22px;display:inline-block}
.label{font-size:15px}
.switch{position:relative;width:52px;height:32px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;inset:0;border-radius:34px;background:var(--track);transition:background .25s}
.knob{position:absolute;left:3px;bottom:3px;width:26px;height:26px;border-radius:50%;background:#fff;transition:transform .25s}
.switch input:checked + .slider{background:var(--on)}
.switch input:checked + .slider .knob{transform:translateX(20px)}
.theme{display:flex;align-items:center;gap:10px;margin-top:6px}
hr{border:0;border-top:1px solid rgba(0,0,0,.06);margin:12px 0}
body.dark hr{border-top:1px solid rgba(255,255,255,.06)}
/* Popup */
.popup {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%) translateY(-10px);
  background: var(--card);
  color: var(--fg);
  padding: 10px 18px;
  border-radius: 14px;
  box-shadow: 0 6px 18px var(--shadow);
  opacity: 0;
  pointer-events: none;
  transition: opacity .5s, transform .5s;
  z-index: 999;
  white-space: nowrap;
}
.popup.show {
  opacity: 1;
  transform: translate(-50%, 0);
}
// Popup logic
let popupTimeout;

function popup(message) {
  const popup = document.querySelector(".popup");
  popup.textContent = message;
  popup.classList.add("show");

  // clear any existing timeout
  if (popupTimeout) clearTimeout(popupTimeout);

  // auto-hide after 2 seconds
  popupTimeout = setTimeout(() => {
    popup.classList.remove("show");
  }, 2000);
}
</style>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
</head>
<body>
<div class="card">
  <div class="h">
    <div class="title">Flag Control</div>
    <div class="theme">
      <span class="material-icons" aria-hidden="true">dark_mode</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle" />
        <span class="slider"><span class="knob"></span></span>
      </label>
    </div>
  </div>

  <div class="row"><div class="left"><span class="material-icons">block</span><div class="label">No Redirect</div></div><label class="switch"><input type="checkbox" id="noredirect"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">settings_system_daydream</span><div class="label">Spoof Lineage Props</div></div><label class="switch"><input type="checkbox" id="NoLineageProp"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">front_hand</span><div class="label">Battery Saving Mode</div></div><label class="switch"><input type="checkbox" id="stop"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">aspect_ratio</span><div class="label">Resize State</div></div><label class="switch"><input type="checkbox" id=".resize_state"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">swap_horiz</span><div class="label">UI Swap</div></div><label class="switch"><input type="checkbox" id=".integrity_ui_swap.flag"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">bug_report</span><div class="label">Spoof Debug Fingerprint</div></div><label class="switch"><input type="checkbox" id="nodebug"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><div class="left"><span class="material-icons">bolt</span><div class="label">Spoof Selinux Status</div></div><label class="switch"><input type="checkbox" id="selinux"><span class="slider"><span class="knob"></span></span></label></div>
</div>

<div class="popup" id="popup"></div>

<script>
const DIR="/data/adb/Box-Brain";
const FILES=["noredirect","NoLineageProp","stop",".resize_state",".integrity_ui_swap.flag","nodebug","selinux"];
const els=Object.fromEntries(FILES.map(f=>[f,document.getElementById(f)]));
const popup=document.getElementById("popup");

const messages={
  "noredirect":{on:"You won't be redirected to release source",off:"Redirect enabled"},
  "NoLineageProp":{on:"Disable if camera doesn't work",off:"Lineage props won't be hidded"},
  "stop":{on:"Whitelist toggle disabled",off:"Whitelist toggle enabled"},
  ".resize_state":{on:"Resize state active",off:"Resize state cleared"},
  ".integrity_ui_swap.flag":{on:"UI Swap enabled",off:"UI Swap disabled"},
  "nodebug":{on:"Debug fingerprint will be cleaned",off:"Debug fingerprint cleaning disabled"},
  "selinux":{on:"SELINUX will be spoofed to Enforcing on boot",off:"OK broðŸ˜‰"}
};

function bridge(){
  if(typeof ksu!=='undefined' && ksu && typeof ksu.exec==='function'){
    return cmd => ksu.exec(cmd);   // sync
  }
  if(typeof Android!=='undefined' && Android && typeof Android.exec==='function'){
    return cmd => Android.exec(cmd);
  }
  return ()=>"";
}
const exec=bridge();

function showPopup(msg){
  popup.textContent=msg;
  popup.classList.add("show");
  setTimeout(()=>popup.classList.remove("show"),2000);
}

function toggleFile(f,enable){
  if(enable){ exec(`touch "${DIR}/${f}"`); showPopup(messages[f].on); }
  else{ exec(`rm -f "${DIR}/${f}"`); showPopup(messages[f].off); }
}

function loadState(){
  FILES.forEach(f=>{
    const out=exec(`[ -f "${DIR}/${f}" ] && echo 1 || echo 0`);
    els[f].checked=(out.trim()==="1");
  });
}

FILES.forEach(f=>{
  els[f].addEventListener('change',()=>toggleFile(f,els[f].checked));
});

function initTheme(){
  const s=localStorage.getItem('theme')||'light';
  document.body.classList.toggle('dark',s==='dark');
  themeToggle.checked=s==='dark';
  themeToggle.addEventListener('change',()=>{
    const dark=themeToggle.checked;
    document.body.classList.toggle('dark',dark);
    localStorage.setItem('theme',dark?'dark':'light');
  });
}

window.addEventListener('DOMContentLoaded',()=>{initTheme();loadState();});
</script>
</body>
</html>